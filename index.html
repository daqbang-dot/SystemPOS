<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chrono-Doc v8.0 | Cyber Command</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;900&family=Space+Grotesk:wght@300;700&family=JetBrains+Mono:wght@500&display=swap" rel="stylesheet">
    <style>
        :root { --accent: #3b82f6; --bg: #020617; }
        body { font-family: 'Space Grotesk', sans-serif; background: var(--bg); color: #f8fafc; overflow: hidden; display: flex; height: 100vh; }
        
        /* SIDEBAR HUD */
        .sidebar { background: #070e1e; border-right: 1px solid #1e293b; width: 360px; flex-shrink: 0; display: flex; flex-direction: column; padding: 1.5rem; overflow-y: auto; z-index: 50; }
        
        /* THE FUTURISTIC CANVAS */
        .main-canvas { flex: 1; background-image: radial-gradient(#1e293b 1px, transparent 1px); background-size: 40px 40px; overflow-y: auto; display: flex; justify-content: center; padding: 4rem 2rem; position: relative; }

        .cyber-canvas { 
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(20px);
            color: #ffffff;
            border-radius: 1rem;
            width: 210mm;
            min-height: 297mm;
            padding: 60px;
            box-shadow: 0 0 50px rgba(0,0,0,0.8), inset 0 0 20px rgba(59, 130, 246, 0.1);
            position: relative;
            border: 1px solid rgba(255,255,255,0.1);
            transition: all 0.5s ease;
        }

        /* TECH CORNERS */
        .cyber-canvas::before { content: ''; position: absolute; top: -2px; left: -2px; width: 40px; height: 40px; border-top: 4px solid var(--accent); border-left: 4px solid var(--accent); }
        .cyber-canvas::after { content: ''; position: absolute; bottom: -2px; right: -2px; width: 40px; height: 40px; border-bottom: 4px solid var(--accent); border-right: 4px solid var(--accent); }

        .hidden-canvas { opacity: 0; transform: scale(0.9) rotateX(10deg); pointer-events: none; position: absolute; }

        /* THEME GLOWS */
        .theme-PENDING { --accent: #3b82f6; box-shadow: 0 0 40px rgba(59, 130, 246, 0.2); }
        .theme-OVERDUE { --accent: #ef4444; box-shadow: 0 0 40px rgba(239, 68, 68, 0.2); }
        .theme-PAID { --accent: #10b981; box-shadow: 0 0 40px rgba(16, 185, 129, 0.2); }
        .theme-DRAFT { --accent: #64748b; }

        .hud-font { font-family: 'Orbitron', sans-serif; letter-spacing: 2px; }
        .mono-font { font-family: 'JetBrains Mono', monospace; }

        .status-DRAFT { background: #64748b; } .status-PAID { background: #10b981; box-shadow: 0 0 15px #10b981; } 
        .status-PENDING { background: #3b82f6; box-shadow: 0 0 15px #3b82f6; } .status-OVERDUE { background: #ef4444; box-shadow: 0 0 15px #ef4444; }

        tr:nth-child(even) { background: rgba(255,255,255,0.03); }

        @media print { 
            .no-print { display: none !important; } 
            .cyber-canvas { background: white !important; color: black !important; border: 1px solid #ddd; border-radius: 0; box-shadow: none !important; width: 100%; }
            .cyber-canvas::before, .cyber-canvas::after { display: none; }
        }
    </style>
</head>
<body>

    <div id="security-lock" class="fixed inset-0 bg-slate-950 z-[1000] flex flex-col items-center justify-center p-6">
        <h1 class="hud-font text-indigo-500 text-3xl mb-8 animate-pulse italic">SECURE ACCESS REQ</h1>
        <input type="password" id="sys-pass" placeholder="CORE-ID" class="bg-slate-900 border border-indigo-900 rounded-lg p-4 text-center text-white font-black tracking-[1em] outline-none mb-4 w-72">
        <button onclick="unlockApp()" class="bg-indigo-600 hover:bg-indigo-400 text-white px-12 py-3 rounded font-black text-xs hud-font transition-all">INITIALIZE</button>
    </div>

    <aside class="sidebar no-print">
        <div class="flex items-center gap-3 mb-10 border-b border-indigo-900/30 pb-4">
            <div class="w-8 h-8 bg-indigo-600 rotate-45 flex items-center justify-center text-white shadow-[0_0_15px_rgba(79,70,229,0.5)]"><span class="rotate-[-45deg] font-black">C</span></div>
            <h1 class="hud-font text-lg font-black italic tracking-widest">CHRONO_8.0</h1>
        </div>

        <div class="bg-indigo-950/20 border border-indigo-500/20 p-5 rounded-lg mb-8">
            <div class="flex justify-between items-center mb-4">
                <span class="text-[8px] hud-font text-indigo-400">NET_DATA_FEED</span>
                <span id="margin-tag" class="text-[9px] font-black text-emerald-400">0% MARGIN</span>
            </div>
            <div class="grid grid-cols-2 gap-4">
                <div><p class="text-[8px] text-slate-500 uppercase">Revenue</p><p id="stat-revenue" class="hud-font text-xs">RM 0.00</p></div>
                <div class="text-right"><p class="text-[8px] text-slate-500 uppercase">Profit</p><p id="stat-profit" class="hud-font text-xs text-emerald-400">RM 0.00</p></div>
            </div>
            <input type="number" id="manual-expenses" oninput="calc()" value="0" placeholder="Expenses" class="w-full bg-slate-900/50 mt-4 p-2 text-[10px] mono-font border border-indigo-900/50 rounded outline-none">
        </div>

        <div class="space-y-4">
            <select id="status-select" onchange="updateStatus(this.value)" class="w-full bg-slate-900 border border-indigo-900/50 p-3 text-[10px] hud-font text-indigo-300 outline-none">
                <option value="DRAFT">TERMINAL: DRAFT</option>
                <option value="PENDING">GENERATE: QUOTE</option>
                <option value="OVERDUE">GENERATE: INVOICE</option>
                <option value="PAID">GENERATE: RECEIPT</option>
            </select>
            <select id="client-dropdown" onchange="applyClient(this.value)" class="w-full bg-slate-900 border border-indigo-900/30 p-3 text-[10px] font-bold text-slate-400 outline-none"></select>
            
            <button onclick="toggleCanvas()" id="toggle-doc-btn" class="w-full py-3 border border-indigo-500/30 text-indigo-400 text-[9px] hud-font hover:bg-indigo-500/10 transition-all">VIEW_CANVAS_INTERFACE</button>
            <button onclick="addRow()" class="w-full py-4 bg-indigo-600 text-white hud-font text-[10px] shadow-[0_0_20px_rgba(79,70,229,0.3)] hover:brightness-125">＋ ADD_DATA_LINE</button>

            <div class="pt-6 space-y-2">
                <button onclick="toggleScraperPortal()" class="w-full py-3 bg-slate-900 border border-slate-800 text-indigo-300 text-[9px] hud-font text-left px-4 italic">01 // SCRAPER_PORTAL</button>
                <button onclick="toggleLeadInjector()" class="w-full py-3 bg-slate-900 border border-slate-800 text-indigo-300 text-[9px] hud-font text-left px-4 italic">02 // LEAD_INJECTOR</button>
                <button onclick="toggleBlast()" class="w-full py-3 bg-emerald-900/20 border border-emerald-500/30 text-emerald-400 text-[9px] hud-font text-left px-4 italic">03 // AUTO_PILOT_MKT</button>
            </div>

            <div class="flex gap-2 pt-4">
                <button onclick="toggleDb()" class="flex-1 py-3 bg-slate-900 text-slate-500 text-[8px] hud-font border border-slate-800">SYS_DB</button>
                <button onclick="generatePDF()" class="flex-[2] py-3 bg-white text-slate-900 text-[9px] hud-font shadow-lg">EXPORT_PDF</button>
            </div>
            <button onclick="toggleSettings()" class="w-full text-[8px] text-slate-600 hud-font mt-4">BRAND_IDENTITY_CONFIG</button>
        </div>
    </aside>

    <main class="main-canvas">
        <div id="document-content" class="cyber-canvas hidden-canvas theme-DRAFT">
            
            <header class="flex justify-between items-start mb-16 border-b border-white/10 pb-10">
                <div class="space-y-6">
                    <img id="logo-img" src="https://via.placeholder.com/150x50?text=CORE+LOGO" class="h-10 opacity-80 brightness-200">
                    <div>
                        <h2 id="dynamic-title" class="hud-font text-5xl font-black italic tracking-tighter text-indigo-400">QUOTATION</h2>
                        <div class="flex items-center gap-4 mt-4">
                            <span id="doc-status-badge" class="px-4 py-1 rounded text-[8px] hud-font text-white status-DRAFT">DRAFT_MODE</span>
                            <span id="rc-tag" class="hidden mono-font text-[10px] text-emerald-400 bg-emerald-400/10 px-2 py-1 border border-emerald-400/20"></span>
                        </div>
                    </div>
                </div>
                <div class="text-right">
                    <h3 id="set-comp-name" class="hud-font text-xl text-white">TECH_CORP_MSIA</h3>
                    <p id="set-comp-addr" class="text-[9px] text-slate-500 uppercase tracking-[0.3em] mt-2">CYBERJAYA // MALAYSIA</p>
                    <p id="set-comp-reg" class="text-[10px] text-indigo-500 mono-font mt-2">ID: 0000000-X</p>
                </div>
            </header>

            <div class="grid grid-cols-2 gap-10 mb-12">
                <div class="bg-white/5 p-8 rounded-lg border-l-4 border-indigo-500">
                    <h4 class="text-[8px] hud-font text-slate-500 uppercase mb-4">RECIPIENT_PROFILE</h4>
                    <p id="c-name" contenteditable="true" class="text-2xl hud-font text-white italic">CLIENT_NAME</p>
                    <p id="c-addr" contenteditable="true" class="text-[10px] text-slate-400 mt-4 leading-relaxed font-bold uppercase">Location data required...</p>
                </div>
                <div class="text-right flex flex-col justify-center space-y-4">
                    <div><p class="text-[8px] hud-font text-slate-500">REF_ID</p><p id="doc-id" contenteditable="true" class="mono-font text-indigo-400">CHRN-2026-001</p></div>
                    <div><p class="text-[8px] hud-font text-slate-500">TIMESTAMP</p><p id="issue-date" contenteditable="true" class="mono-font">30/01/2026</p></div>
                </div>
            </div>

            <table class="w-full mb-16">
                <thead>
                    <tr class="text-[9px] hud-font text-indigo-400 border-b border-white/10 uppercase">
                        <th class="py-4 text-left">Module / Description</th>
                        <th class="py-4 text-center">Unit</th>
                        <th class="py-4 text-right">Rate RM</th>
                        <th class="py-4 text-right">Amount</th>
                        <th class="no-print"></th>
                    </tr>
                </thead>
                <tbody id="item-list" class="text-xs font-bold"></tbody>
            </table>

            <div class="mt-auto grid grid-cols-12 gap-6 items-end">
                <div class="col-span-7">
                    <div id="terms-container" class="text-[8px] mono-font text-slate-500 leading-relaxed p-4 border border-white/5 rounded italic uppercase">TERMS: 50% CRED_REQ. ALL SALES ARE FINAL.</div>
                    <img id="stamp-img" class="w-24 h-24 object-contain opacity-20 mt-6 grayscale brightness-200">
                </div>
                <div class="col-span-5">
                    <div class="bg-indigo-600/10 border border-indigo-500/30 p-8 rounded-lg text-right relative overflow-hidden">
                        <div class="absolute top-0 right-0 w-16 h-16 border-t-2 border-r-2 border-indigo-400 opacity-30"></div>
                        <p class="text-[9px] hud-font text-indigo-400 mb-2">TOTAL_VAL_RM</p>
                        <p id="grand-total" class="text-4xl hud-font text-white italic">0.00</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        let inventory = []; let clients = []; let isAuto = false; let queueIdx = 0;

        function unlockApp() {
            if (document.getElementById('sys-pass').value === "1234") {
                document.getElementById('security-lock').style.opacity = '0';
                setTimeout(() => document.getElementById('security-lock').classList.add('hidden'), 500);
            }
        }

        function toggleCanvas() { 
            const canvas = document.getElementById('document-content');
            canvas.classList.toggle('hidden-canvas');
            document.getElementById('toggle-doc-btn').innerText = canvas.classList.contains('hidden-canvas') ? "VIEW_CANVAS_INTERFACE" : "DISCONNECT_CANVAS";
        }

        // Use the same logic as v7.2 for syncData, calc, addRow, fillRow, applyClient, etc.
        // I've simplified the function calls here for readability but keep your full v7.2 JS.
        
        function updateStatus(v) { 
            const badge = document.getElementById('doc-status-badge');
            const canvas = document.getElementById('document-content');
            badge.innerText = v + '_MODE'; 
            badge.className = `px-4 py-1 rounded text-[8px] hud-font text-white status-${v}`;
            canvas.className = `cyber-canvas theme-${v} ${canvas.classList.contains('hidden-canvas') ? 'hidden-canvas' : ''}`;
            document.getElementById('dynamic-title').innerText = v === 'PAID' ? 'RECEIPT' : (v === 'OVERDUE' ? 'INVOICE' : 'QUOTATION');
            document.documentElement.style.setProperty('--accent', v === 'PAID' ? '#10b981' : (v === 'OVERDUE' ? '#ef4444' : '#3b82f6'));
        }

        function addRow() {
            const row = document.createElement('tr'); row.className = "border-b border-white/5";
            let opt = inventory.map((v, i) => `<option value="${i}">${v.n}</option>`).join('');
            row.innerHTML = `<td class="py-5"><select onchange="fillRow(this)" class="no-print bg-slate-900 text-[8px] hud-font p-1 mb-2 outline-none border border-white/10"><option value="">SELECT_MODULE...</option>${opt}</select><div contenteditable="true" class="text-indigo-200">ITEM_NAME</div><div contenteditable="true" class="text-[9px] text-slate-500 uppercase">Description...</div></td><td class="text-center mono-font" contenteditable="true" oninput="calc()">1</td><td class="text-right mono-font text-slate-400" contenteditable="true" oninput="calc()">0.00</td><td class="text-right hud-font text-indigo-400">0.00</td><td class="no-print text-right"><button onclick="this.parentElement.parentElement.remove(); calc();" class="text-slate-600 font-bold hover:text-rose-500 px-2">×</button></td>`;
            document.getElementById('item-list').appendChild(row);
        }

        // [INSERT REST OF v7.2 JS HERE FOR FULL FUNCTIONALITY]
        // This includes syncData(), saveDb(), processLeadInjection(), calc(), fillRow(), etc.
        // Ensure all localStorage keys (v8_inv, etc.) are updated if you want a clean start.
    </script>
</body>
</html>
